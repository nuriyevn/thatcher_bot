{% load staticfiles %}

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!--script src="{% static 'dish/js/index.js' %}"></script-->

    <script>
        $(document).ready(function() {


     $('button[id="sendDinner2"]').on('click', function(){
        $('#status').text("Статус відправки замовлення у групу: ")
        var dishesList = $('textarea[name="final"]').val();
        var textToSend ="Замовлення через http://nuriyevn.pythonanywhere.com/dish/!%0A%0A"
        textToSend += $('#person').val() + "%0A%0A"
        textToSend += dishesList


        $.ajax({
            url: 'https://api.telegram.org/bot800787990:AAHo4OBTilvKuOiEpInOvICNFIfEw_rAYek/getMe',
            type:'GET',
            // 128501515
            data: null,
            complete: function(event)
            {
                console.log(event.responseText);
            }

        });

        textToSend = textToSend.replace(/(?:\r\n|\r|\n)/g, '%0A');


        if (dishesList.trim().length > 0)
            $.ajax({
                url: 'https://api.telegram.org/bot800787990:AAHo4OBTilvKuOiEpInOvICNFIfEw_rAYek/sendMessage',
                type:'GET',
                // 128501515 - тестова група
                // 254455448 -  група обіди
                data: 'chat_id=-254455448&parseMode=html&text=' + textToSend,
                complete: function(event)
                {
                    console.log(event)

                }
            });

        else
        {
            $('#status').text("Пусте замовлення")
        }


        console.log("Send pressed")
     });

     $('input').on('click', function(){
        var final = '';
        $('#sum').attr('style', "color:green;");

        var ids = [];
        $('input:checked').each(function(){

            if (parseInt(this.value, 10) !== 0){
                final += $(this)[0].nextSibling.textContent;
                final += '\n'
                console.log($(this)[0].nextSibling);
                ids.push($(this).val())
            }
        })

        console.log(ids);
        $.ajax({
            url: '/dish/calculate',
            data: { ids },
            type:"GET",
            complete: function(event){

                var old = 'Сума: ';
                if (parseFloat(event.responseText) > 160.0)
                    $('#sum').attr('style', "color:red;");

                $('#sum').text(old + event.responseText);
            }
        })

        $('textarea[name="final"]').val(final);
     })
});


    </script>

</head>>
<body>
<br>


<div>
    <label>Ім'я</label>
<input id="person"  type="text" value="">
<form style="float:left;">
    <label for="">Супи {{ soup_price }}</label>
<fieldset id="soup_group">
    <input type="radio" name="soup"  checked value="0">Null/Нічого<br>
    {% for soup in all_soup %}
        <input type="radio" name="soup" value="{{ soup.id }}">{{ soup.name }}<br>
    {% endfor %}
</fieldset>
</form>

<form >
    <label for="">Брускети {{ bruschetta_price }}</label>
<fieldset id="bruschetta_group">
    <input type="radio" name="bruschetta" checked value="0">Null/Нічого<br>
    {% for bruschetta in all_bruschettas %}
        <input type="radio" name="bruschetta" value="{{ bruschetta.id }}">{{ bruschetta.name }}<br>
    {% endfor %}
</fieldset>
</form>
</div>


    <form>
            <label for="">Салати</label>
<fieldset id="salad_group">
    <input type="radio" name="salad" checked value="0">Null/Нічого<br>
    {% for salad in all_salads %}
        <input type="radio" name="salad" value="{{ salad.id }}">{{ salad.name }} - {{ salad.cost }} <br>
    {% endfor %}
</fieldset>
</form>


<div style="border: solid 1px black; ">
                    <div style="float:left;">
            <form>
                    <label for="">Основні страви {{ main_price }}</label>
            <fieldset id="main_group">
                <input type="radio" name="main_dish" checked value="0">Null/Нічого<br>
                {% for main in all_mains %}
                    <input type="radio" name="main_dish" value="{{main.id}}">{{ main.name }}<br>
                {% endfor %}
            </fieldset>
            </form>



            <form>
                        <label for="">Соуси</label>
            <fieldset id="sauce_group">

                <input type="radio" name="sauce_dish" checked value="0">Null/Нічого<br>
                {% for sauce in all_sauces %}
                    <input type="radio" name="sauce_dish" value="{{sauce.id}}">{{ sauce.name }}<br>
                {% endfor %}
            </fieldset>
            </form>
            </div>


            <form>
                    <label for="">Гарніри</label>
            <fieldset id="side_group">
                <input type="radio" name="side_dish" checked value="0">Null/Нічого<br>
                {% for side in all_sides %}
                    <input type="radio" name="side_dish" value="{{side.id}}">{{ side.name }}<br>
                {% endfor %}
            </fieldset>
            </form>


            <form>
                    <label for="">Напої</label>
            <fieldset id="drink_group">
                <input type="radio" name="drink" checked value="0">Null/Нічого<br>
                {% for drink in all_drinks %}
                    <input type="radio" name="drink" value="{{drink.id}}">{{ drink.name }}<br>
                {% endfor %}
            </fieldset>
            </form>

</div>



<form>
    <label for="">Додатково {{ addon_price }}</label>
<fieldset id="addon_group">
    <input type="radio" name="addon"  checked value="0">Null/Нічого<br>
    {% for addon in all_addons %}
        <input type="radio" name="addon" value="{{ addon.id }}">{{ addon.name }}<br>
    {% endfor %}
</fieldset>
</form>

<label for="">Загалом</label>
<textarea name="final" row="20" style="width:200px;height:200px;">
</textarea>

<label style="color:green;" id="sum">Сума: </label>
<!--button id="sendDinner">Відправити у обіди</button-->


<label style="color:green;" id="status">Статус відправки замовлення у групу: </label>

</body>

